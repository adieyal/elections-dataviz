(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./src/api/index.js":function(e,n,t){"use strict";t.d(n,"a",function(){return _}),t.d(n,"c",function(){return h}),t.d(n,"d",function(){return N}),t.d(n,"b",function(){return E});var a=t("./node_modules/apollo-client/ApolloClient.js"),i=t("./node_modules/apollo-link-http/lib/bundle.esm.js"),o=t("./node_modules/apollo-cache-inmemory/lib/inMemoryCache.js"),r=t("./node_modules/graphql-tag/src/index.js"),s=t.n(r);function l(){var e=g(['\n        {\n          allVotingDistrictBallots( \n          event_Description:"','",\n          location_Ward_Municipality_Name_Icontains:"','") {\n            edges{\n              node{\n                location {\n                  vdNumber\n                }\n                partyResults {\n                  edges{\n                    node{\n                      party{\n                        name\n                        abbreviation\n                      }\n                    }\n                  }  \n                }\n              }\n            }\n          }\n        }\n        ']);return l=function(){return e},e}function c(){var e=g(['\n      {\n        allMunicipalBallots(\n          event_Description:"','",\n          location_Province_Name:"','"\n        ) {\n          edges{\n            node {\n              partyResults {\n                edges{\n                  node{\n                    party {               \n                      name\n                      abbreviation\n                    }\n                    validVotes\n                    percOfVotes\n                  }\n                }\n                \n              }\n              location {\n                code\n                name\n                longName\n              }\n            }\n          }\n        }\n      }\n      ']);return c=function(){return e},e}function p(){var e=g(['\n      {\n        allProvincialBallots(\n          event_Description:"','"\n        ){\n          edges{\n            node{\n              partyResults {\n                edges{\n                  node{\n                    validVotes\n                    percOfVotes\n                    party {\n                      id\n                      name\n                      abbreviation\n                    }\n                  }\n                }\n              }\n              location {\n                id\n                name\n              }\n            }\n          }\n        }\n      }\n      ']);return p=function(){return e},e}function u(){var e=g(['\n      {\n        allVotingDistrictBallots(\n        event_Description:"','",\n        location_Id:"','", \n        location_Ward_Municipality_Name_Icontains:"','") {\n          edges{\n            node{\n              location {\n                vdNumber\n              }\n              partyResults {\n                edges{\n                  node{\n                    party{\n                      name\n                    }\n                    percOfVotes\n                  }\n                }  \n              }\n            }\n          }\n        }\n      }\n      ']);return u=function(){return e},e}function d(){var e=g(['\n      {\n        allMunicipalBallots(\n          event_Description:"','",\n          location_Province_Name:"','", \n          location_Code: "','"\n        ) {\n          edges{\n            node {\n              partyResults {\n                edges{\n                  node{\n                    party {               \n                      name\n                      abbreviation\n                    }\n                    validVotes\n                    percOfVotes\n                  }\n                }\n                \n              }\n              location {\n                code\n                name\n                longName\n              }\n            }\n          }\n        }\n      }\n      ']);return d=function(){return e},e}function m(){var e=g(['\n      {\n        allProvincialBallots(\n          event_Description:"','",\n          location_Name_Icontains:"','"\n        ){\n          edges{\n            node{\n              partyResults {\n                edges{\n                  node{\n                    validVotes\n                    percOfVotes\n                    party {\n                      id\n                      name\n                      abbreviation\n                    }\n                  }\n                }\n              }\n              location {\n                id\n                name\n              }\n            }\n          }\n        }\n      }\n      ']);return m=function(){return e},e}function v(){var e=g(['\n      {\n        allBallots(\n          event_Description:"','"\n        ){\n          edges{\n            node{\n              partyResults {\n                edges{\n                  node{\n                    validVotes\n                    percOfVotes\n                    party {\n                      id\n                      name\n                      abbreviation\n                    }\n                  }\n                }\n                \n              }\n              location {\n                id\n                name\n              }\n            }\n          }\n        }\n      }\n      ']);return v=function(){return e},e}function y(){var e=g(["\n    {\n      allParties {\n        edges{\n          node{\n            name\n            colour\n          }\n        }\n      }\n    }\n    "]);return y=function(){return e},e}function f(){var e=g(["\n    {\n      allEvents {\n        description\n      }\n    }\n    "]);return f=function(){return e},e}function g(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var b=new a.a({link:new i.a({uri:"https://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new o.a});function _(){return b.query({query:s()(f())})}function h(){return b.query({query:s()(y())})}function N(e){var n=e.eventDescription;if(n){if("national"==e.regionType)return b.query({query:s()(v(),n)});if("province"==e.regionType)return b.query({query:s()(m(),n,e.provinceName)});if("municipality"==e.regionType){var t=e.muniName.split(" - ")[0];return b.query({query:s()(d(),n,e.provinceName,t)})}return"municipality-vd"==e.regionType?b.query({query:s()(u(),n,e.vdNumber,e.muniCode)}):void 0}}function E(e){var n=e.eventDescription;if(n){if("national"==e.regionType)return b.query({query:s()(p(),n)});if("province"==e.regionType)return b.query({query:s()(c(),n,e.provinceName)});if("municipality"==e.regionType){var t=e.muniName.split(" - ")[1];return b.query({query:s()(l(),n,t)})}}}},"./src/components/Map/map.css":function(e,n,t){e.exports={region:"map_region__1GVD7","loading-spinner":"map_loading-spinner__2woTM","map-navbar":"map_map-navbar__1sP3i","map-container":"map_map-container__1nrEx",map:"map_map__1IdTC"}},"./src/components/Map/map.js":function(e,n,t){"use strict";var a=t("./node_modules/react/index.js"),i=t.n(a),o=t("./node_modules/d3/index.js"),r=t("./node_modules/topojson-client/index.js"),s=(t("./node_modules/react-sidenav/index.js"),t("./src/config/index.js")),l=t("./node_modules/polylabel/index.js"),c=t.n(l),p=t("./src/components/Map/map.css"),u=t.n(p),d=t("./src/events/index.js"),m=t("./node_modules/react-loading/dist/react-loading.js"),v=t.n(m),y=t("./src/api/index.js"),f=t("./src/utils/index.js");function g(e){return(g="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return(b="function"===typeof Symbol&&"symbol"===g(Symbol.iterator)?function(e){return g(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":g(e)})(e)}function _(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,n){return(N=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var T,w="#9c9c9c";function j(e){return u.a[e]||e}var C=function(e){function n(e){var t,a,i;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),a=this,(t=!(i=h(n).call(this,e))||"object"!==b(i)&&"function"!==typeof i?E(a):i).state={disableNavigation:!1,eventDescription:"2014 National Election",regionType:"national",provinceName:"",muniName:"",muniCode:"",vdNumber:""},e.regionType&&(t.state.regionType=e.regionType),e.provinceName&&(t.state.provinceName=e.provinceName),e.muniName&&(t.state.muniName=e.muniName),e.disableNavigation&&(t.state.disableNavigation=e.disableNavigation),t.handlePreviewEvent=t.handlePreviewEvent.bind(E(E(t))),t}var t,l,p;return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&N(e,n)}(n,a["Component"]),t=n,(l=[{key:"draw",value:function(e,n){console.log("drawing ...map"),this.drawGraph(e,n)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.state),document.addEventListener(d.a.MAP_PREVIEW,this.handlePreviewEvent)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(d.a.MAP_PREVIEW,this.handlePreviewEvent)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.state)}},{key:"handlePreviewEvent",value:function(e){var n=e.detail;this.setState(n)}},{key:"handleNavBarSelection",value:function(e,n){var t;if("national"==e){if(t={regionType:e},this.state.regionType==t.regionType)return}else if("province"==e){if(t={regionType:e,provinceName:n.name},this.state.regionType==t.regionType&&this.state.provinceName==t.provinceName)return}else if("municipality"==e&&(t={regionType:e,provinceName:n.provinceName,muniName:n.muniName,muniCode:n.muniCode},this.state.regionType==t.regionType&&this.state.provinceName==t.provinceName&&this.state.newState==t.muniName))return;var a=new CustomEvent(d.a.REGION_CHANGE,{detail:t});document.dispatchEvent(a),this.setState(t)}},{key:"getRegionName",value:function(){return"national"==this.state.regionType?"South Africa":"province"==this.state.regionType?this.state.provinceName:"municipality"==this.state.regionType?this.state.muniName:"municipality-vd"==this.state.regionType?this.state.muniName+"-"+this.state.vdNumber:void 0}},{key:"getContainer",value:function(){return o.i(this.refs.vizcontainer)}},{key:"getLoadingSpinner",value:function(){return o.i(this.refs.loading)}},{key:"render",value:function(){this.state.disableNavigation;return i.a.createElement("div",{className:"map-container"},this.getRegionName(),i.a.createElement("div",{className:"loading-spinner",ref:"loading"},i.a.createElement(v.a,{type:"spin",color:"#777",height:100,width:100})),i.a.createElement("div",{ref:"vizcontainer",style:{display:"hidden"},className:"map"}))}},{key:"drawGraph",value:function(e,n){var t=this,a="province_lo-res.geojson";var i,l=s.a.DOMAIN+"/mapdata/"+function(){switch(t.state.regionType){case"national":return a;case"province":return{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[t.state.provinceName];case"municipality":return t.state.muniCode+".topojson";default:return null}}();t.getLoadingSpinner().style("display","block").transition().duration(200).style("opacity",1),i=document.getElementsByClassName("tooltip")[0]?o.i(".tooltip"):o.i("body").append("div").attr("class",j("tooltip")).style("opacity",0),console.log("process.env",Object({NODE_ENV:"production",PUBLIC_URL:"/elections-dataviz/docz/",npm_package_dependencies_docz_plugin_css:"^0.11.0",npm_package_scripts_docz_build:"docz build",npm_package_dependencies_docz_plugin_babel6:"^0.11.0",npm_package_scripts_docz_dev:"docz dev",npm_package_devDependencies_docz_theme_default:"^0.13.7"}));e.selectAll("svg").remove();var p=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#ffffff").attr("viewBox","0 0 900 800").classed("svg-content",!0),u=[o.f(l),Object(y.b)(n)];if(!T){var m=Object(y.c)();u.push(m)}Promise.all(u).then(function(e){var a=e[0],s=Object(f.a)(e[1],n);T=T||e[2];var u,m={};T&&T.data.allParties.edges&&T.data.allParties.edges.forEach(function(e){m[e.node.name]=e.node.colour}),-1!==l.indexOf(".topojson")&&(a=r.a(a,a.objects[t.state.muniCode])),u=a.features;var v=o.d().fitSize([900,800],a),y=o.e().projection(v);if(p.selectAll(".".concat(j("region"))).data(u).enter().append("path").attr("class",j("region")).attr("stroke","#eeeeee").attr("fill",function(e,n){var a,i,o=t.state.regionType;if("national"===o){var r=e.properties.SPROVINCE;a=s[r],console.log("mainParty",a,r),console.log("partyColor",p)}else if("province"===o){var l=(i=e.properties).code||i.smunicipal.split("-")[0].replace(/\s/g,"");a=s[l]}else{var c=function(e){return e.PKLVDNUMBE}(e.properties);a=s[c]}var p=function(e){return e&&m[e.split("/")[0]]||w}(a);return p}).attr("id",function(e,n){return"region-".concat(n)}).attr("d",y),"municipality"!==t.state.regionType&&p.selectAll(".place-label").data(u).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(e){var n,t;return"Polygon"===e.geometry.type?(n=c()(e.geometry.coordinates),(t=v(n))[1]-=12,"translate("+t+")"):(n=c()(e.geometry.coordinates[0]),(t=v(n))[1]-=5,"translate("+t+")")}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return"national"===t.state.regionType?e.properties.SPROVINCE:"province"===t.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]}),"municipality"!==t.state.regionType){var g,b=document.getElementsByClassName("place-label"),_={},h={};for(g=0;g<u.length;g++)_[g]=b[g].getBoundingClientRect();for(g=0;g<u.length;g++){for(var N=0;N<g;N++){var E=_[g],C=_[N];!(E.right<C.left||E.left>C.right||E.bottom<C.top||E.top>C.bottom)&&(h[g]=h[g]?h[g]+1:1)}h[g]>2?b[g].setAttribute("opacity",0):h[g]>0&&(b[g].innerHTML=b[g].innerHTML.slice(0,3)+"...")}}(p.selectAll(".eventLayer").data(u).enter().append("path").attr("d",y).attr("class","eventLayer").attr("id",function(e,n){return"eventLayer-".concat(n)}).attr("fill","transparent").on("mouseover",function(e,n){o.i("#region-".concat(n)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(e){"municipality"!==t.state.regionType&&(i.transition().duration(200).style("opacity",1),i.html("national"===t.state.regionType?e.properties.SPROVINCE:"province"===t.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",o.c.pageX+"px").style("top",o.c.pageY-28+"px"))}).on("mouseout",function(e,n){o.i("#region-".concat(n)).attr("stroke-width",1).style("fill-opacity",1),"municipality"!==t.state.regionType&&i.transition().duration(200).style("opacity",0)}).on("click",function(e,n){if(!t.state.disableNavigation){i.transition().duration(200).style("opacity",0);var a,o=t.state.regionType;if("national"===o)r={regionType:"province",provinceName:e.properties.SPROVINCE},s=new CustomEvent(d.a.REGION_CHANGE,{detail:r}),document.dispatchEvent(s),t.setState(r);else if("province"===o){r={regionType:"municipality",provinceName:t.state.provinceName,muniName:e.properties.smunicipal,muniCode:(a=e.properties,a.code||a.smunicipal.split("-")[0].replace(/\s/g,""))},s=new CustomEvent(d.a.REGION_CHANGE,{detail:r}),document.dispatchEvent(s),t.setState(r)}else{var r={regionType:"municipality-vd",provinceName:t.state.provinceName,muniName:t.state.muniName,muniCode:t.state.muniCode,vdNumber:function(e){return e.PKLVDNUMBE}(e.properties)},s=new CustomEvent(d.a.REGION_CHANGE,{detail:r});document.dispatchEvent(s)}}}),t.state.disableNavigation)||p.append("foreignObject").attr("x",800).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var e,n=t.state.regionType,a={regionType:t.state.regionType,provinceName:t.state.provinceName,muniName:t.state.muniName,muniImuniCodeD:t.state.muniCode,vdNumber:t.state.vdNumber};"province"===n?a.regionType="national":"municipality"===n&&(a.regionType="province"),e=new CustomEvent(d.a.REGION_CHANGE,{detail:a}),document.dispatchEvent(e),t.setState(a)});t.getLoadingSpinner().style("display","none")});window.addEventListener("resize",function(){},200)}}])&&_(t.prototype,l),p&&_(t,p),n}();n.a=C,C.__docgenInfo={description:"",methods:[{name:"draw",docblock:null,modifiers:[],params:[{name:"container",type:null},{name:"props",type:null}],returns:null},{name:"handlePreviewEvent",docblock:null,modifiers:[],params:[{name:"event",type:null}],returns:null},{name:"handleNavBarSelection",docblock:null,modifiers:[],params:[{name:"regionType",type:null},{name:"selectionData",type:null}],returns:null},{name:"getRegionName",docblock:null,modifiers:[],params:[],returns:null},{name:"getContainer",docblock:null,modifiers:[],params:[],returns:null},{name:"getLoadingSpinner",docblock:null,modifiers:[],params:[],returns:null},{name:"drawGraph",docblock:null,modifiers:[],params:[{name:"container",type:null},{name:"props",type:null}],returns:null}],displayName:"Map"}},"./src/config/index.js":function(e,n,t){"use strict";n.a={DOMAIN:"https://sabc-eds.github.io/elections-dataviz"}},"./src/events/index.js":function(e,n,t){"use strict";n.a={REGION_CHANGE:"region-change",BARCHART_PREVIEW:"barchart-preview",MAP_PREVIEW:"map-preview"}},"./src/utils/index.js":function(e,n,t){"use strict";function a(e,n){var t,a=n.regionType;if(!(t="national"==a?e.data.allBallots.edges[0]:"province"==a?e.data.allProvincialBallots.edges[0]:"municipality"==a?e.data.allMunicipalBallots.edges[0]:e.data.allVotingDistrictBallots.edges[0]))return console.error("party data is empty!!"),null;var i=t.node;return(i.partyResults||i.topResult).edges.slice(0,n.numParties).map(function(e){var n=e.node;return{name:n.party.abbreviation,validVotes:n.validVotes,percOfVotes:n.percOfVotes,partyInfo:n.party}})}function i(e,n){if(!e)return null;var t={},a=n.regionType;return console.log("parseMainPartyData",e,a),"national"===a?e.data.allProvincialBallots.edges.forEach(function(e){var n=e.node,a=n.location.name,i=(n.partyResults||n.topResult).edges[0].node.party.name;t[a]=i}):"province"===a?e.data.allMunicipalBallots.edges.forEach(function(e){var n=e.node,a=n.location.code,i=(n.partyResults||n.topResult).edges[0].node.party.name;t[a]=i}):e.data.allVotingDistrictBallots.edges.forEach(function(e){var n=e.node,a=n.location.vdNumber,i=(n.partyResults||n.topResult).edges[0].node.party.name;t[a]=i}),t}t.d(n,"b",function(){return a}),t.d(n,"a",function(){return i})}}]);
//# sourceMappingURL=src-components-barchart-with-nav-map-barchart-map~src-components-map-map.4360e7251d18a8dca0bb.js.map