(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(t,e,n){},33:function(t,e,n){},37:function(t,e,n){t.exports=n(60)},42:function(t,e,n){},44:function(t,e,n){},57:function(t,e,n){},60:function(t,e,n){"use strict";n.r(e);var a=n(2),r=n.n(a),o=n(21),i=n.n(o),s=(n(42),n(7)),c=n(8),l=n(10),p=n(9),u=n(11),d=(n(44),n(6)),g=n(1),m=n(22),f=n.n(m),v="region-change",y=n(23),h=n(66),b=n(35),N=n(67),w=n(25),j=n.n(w);function x(){var t=Object(y.a)(['\n        {\n          allProvincialBallots(\n              event_Description_Icontains:"2004", \n            event_EventType_Description_Icontains:"National",\n            location_Name:"','"\n        \n          ) {\n            edges {\n              node {\n                topResult(validVotes_Gt:1000, last:',") {\n                  edges {\n                    node {\n                      validVotes\n                      party {\n                        name\n                        abbreviation\n                      }\n                    }\n                  }\n                }\n                location {\n                  name\n                }\n              }\n            }\n          }\n        }\n        "]);return x=function(){return t},t}var E=new h.a({link:new b.a({uri:"http://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new N.a});var k,C=3e3,T=[{R:0,G:114,B:47},{R:3,G:62,B:108},{R:131,G:23,B:27},{R:170,G:0,B:14},{R:76,G:114,B:114},{R:191,G:135,B:50}],O=1;function R(t){return f.a[t]||t}function _(t,e,n){var a=T,r=t.append("svg").attr("width",e+70).attr("height",n+20);function o(t){return"gradientrgb-".concat(t.R,"-").concat(t.G,"-").concat(t.B)}function i(t,e){t.append("linearGradient").attr("id",o(e)).selectAll("stop").data([[0,0],[11,92],[25,15],[82,35],[100,4]]).enter().append("stop").attr("offset",function(t){return t[0]+"%"}).attr("stop-color",function(t){return function(t){var n=(e.R*(100-t)+255*t)/100,a=(e.G*(100-t)+255*t)/100,r=(e.B*(100-t)+255*t)/100;return"rgb(".concat(n,",").concat(a,",").concat(r,")")}(t[1])}).attr("stop-opacity",1)}for(var s,c=r.append("defs"),l=0;l<a.length;l++)i(c,a[l]);s=document.getElementsByClassName("tooltip")[0]?g.j(".tooltip"):g.j("body").append("div").attr("class",R("tooltip")).style("opacity",0);var p=g.h().rangeRound([70,e]),u=g.i().rangeRound([n,20]);r.append("g").attr("transform","translate(20,"+(n/2+10)+")").append("text").attr("class",R("percentage-label")).attr("transform","rotate(-90)").text("PERCENTAGE VOTES").attr("text-anchor","middle"),r.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")"),r.append("g").attr("class","y axis").attr("transform","translate(70, 0)"),r.append("g").attr("class",R("grid")).attr("transform","translate(70, 0)");var d=r.append("g").attr("class",R("bar-container")),m=r.append("g").attr("class",R("bartext-container"));this.draw=function(t){p.domain(t.map(function(t){return t.name})),u.domain([0,g.g(t,function(t){return Number(t.value)})]),r.select(".x.axis").transition().duration(300).call(g.a(p)),r.select(".y.axis").transition().duration(300).call(g.b(u).ticks(6).tickSize(70-e)),r.select(".grid").transition().duration(300).call(g.b(u).ticks(6).tickSize(70-e).tickFormat(""));var i=d.selectAll(".".concat(R("bar"))).data(t);i.exit().transition().duration(300).attr("y",function(t){return u(0)}).attr("height",0).style("fill-opacity",1e-6).remove(),i.enter().append("rect").attr("class",R("bar")).attr("x",function(t){return p(t.name)+p.bandwidth()/20}).attr("width",9*p.bandwidth()/10).attr("fill",function(t,e){return"url(#".concat(o(a[e%a.length]),")")}).on("mousemove",function(t){g.j(this).attr("opacity",.8),s.transition().duration(200).style("opacity",.9),s.html(t.name+" : "+t.value).style("left",g.c.pageX+"px").style("top",g.c.pageY-28+"px")}).on("mouseout",function(t){g.j(this).attr("opacity",1),s.transition().duration(200).style("opacity",0)}).attr("y",function(t){return u(0)}).attr("height",0),d.selectAll(".".concat(R("bar"))).data(t).transition().duration(300).attr("y",function(t){return u(Number(t.value))}).attr("height",function(t){return n-u(Number(t.value))});var c=m.selectAll(".".concat(R("bartext"))).data(t);c.exit().transition().duration(300).attr("y",function(t){return u(0)-5}).style("fill-opacity",1e-6).remove(),c.enter().append("text").attr("class",R("bartext")).attr("x",function(t){return p(t.name)+p.bandwidth()/2}).attr("text-anchor","middle").attr("font-size","12px").attr("y",function(t){return u(0)-5}),m.selectAll(".".concat(R("bartext"))).data(t).text(function(t){return t.value}).transition().duration(300).attr("y",function(t){return u(Number(t.value))-5})},this.destroy=function(){r.remove()}}a.Component;var A=n(34),S=n(18),B=n.n(S),G=n(33),P=n.n(G);function I(t){return P.a[t]||t}var L=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).state={regionType:"national",regionName:"SA",parentProvinceName:""},t.regionType&&(n.state.regionType=t.regionType),t.regionName&&(n.state.regionName=t.regionName),n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"drawGraph",value:function(t,e){console.log("drawGraph","new",this);var n=this,a="province_lo-res.geojson";var r,o="/mapdata/"+function(){switch(n.state.regionType){case"national":return a;case"province":return t=n.state.regionName,console.log("getProvinceFileName",t),{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[t];case"municipality":return n.state.regionName+".topojson"}var t}();r=document.getElementsByClassName("tooltip")[0]?g.j(".tooltip"):g.j("body").append("div").attr("class",I("tooltip")).style("opacity",0),-1!=JSON.stringify(Object({NODE_ENV:"production",PUBLIC_URL:"."})).indexOf("docz")&&(o="/public"+o),console.log("fullRouteGeoJsonFile",o);var i=1400;t.selectAll("svg").remove();var s=t.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#c9e8fd").attr("viewBox","0 0 1400 700").classed("svg-content",!0),c=(s.append("foreignObject").attr("x",1300).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var t=n.state.regionType;if("province"==t)n.setState({regionType:"national",regionName:"SA"});else if("municipality"==t){n.setState({regionType:"province",regionName:(n.regionName,n.state.parentProvinceName)})}}),g.f(o));Promise.all([c]).then(function(t){console.log("json load Finished");var e,a=t[0];-1!=o.indexOf(".topojson")&&(a=A.a(a,a.objects[n.state.regionName])),e=a.features,console.log("getJsonDataFeatures",e);var c=g.d().fitSize([i,700],a),l=g.e().projection(c);s.selectAll(".".concat(I("region"))).data(e).enter().append("path").attr("class",I("region")).attr("stroke","#FFF").attr("fill","green").attr("id",function(t,e){return"region-".concat(e)}).attr("d",l),s.selectAll(".place-label").data(e).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(t){if("Polygon"==t.geometry.type){var e=B()(t.geometry.coordinates);return console.log("center",e),(n=c(e))[1]-=12,"translate("+n+")"}var n;e=B()(t.geometry.coordinates[0]);return(n=c(e))[1]-=5,"translate("+n+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(t){return"national"==n.state.regionType?t.properties.SPROVINCE:"province"==n.state.regionType?t.properties.smunicipal.split("-")[1].split("[")[0]:t.properties.SMUNICIPAL.split("-")[1].split("[")[0]});for(var p=document.getElementsByClassName("place-label"),u={},d={},m=0;m<e.length;m++)u[m]=p[m].getBoundingClientRect();for(m=0;m<e.length;m++){for(var f=0;f<m;f++){var y=u[m],h=u[f];!(y.right<h.left||y.left>h.right||y.bottom<h.top||y.top>h.bottom)&&(d[m]=d[m]?d[m]+1:1)}d[m]>2?p[m].setAttribute("opacity",0):d[m]>0&&(p[m].innerHTML=p[m].innerHTML.slice(0,3)+"...")}for(m=0;m<e.length;m++);console.log("regions",d),s.selectAll(".eventLayer").data(e).enter().append("path").attr("d",l).attr("class","eventLayer").attr("id",function(t,e){return"eventLayer-".concat(e)}).attr("fill","transparent").on("mouseover",function(t,e){g.j("#region-".concat(e)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(t){r.transition().duration(200).style("opacity",1),r.html("national"==n.state.regionType?t.properties.SPROVINCE:"province"==n.state.regionType?t.properties.smunicipal.split("-")[1].split("[")[0]:t.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",g.c.pageX+"px").style("top",g.c.pageY-28+"px")}).on("mouseout",function(t,e){g.j("#region-".concat(e)).attr("stroke-width",1).style("fill-opacity",1),r.transition().duration(200).style("opacity",0)}).on("click",function(t,e){console.log("click event",e,t.properties);var a,r=n.state.regionType;if("national"==r){var o={regionType:"province",regionName:t.properties.SPROVINCE},i=new CustomEvent(v,o);document.dispatchEvent(i),n.setState(o)}else if("province"==r){o={regionType:"municipality",regionName:(a=t.properties,a.smunicipal.split("-")[0].replace(/\s/g,"")),parentProvinceName:n.state.regionName},i=new CustomEvent(v,o);document.dispatchEvent(i),n.setState(o)}else{o={regionType:"municipality-region",regionName:function(t){return t.SMUNICIPAL.split("-")[0].replace(/\s/g,"")}(t.properties)},i=new CustomEvent(v,o);document.dispatchEvent(i)}}),console.log("svg drawing finished")});window.addEventListener("resize",function(){},200)}},{key:"draw",value:function(t,e){this.drawGraph(t,e)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.props)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.props)}},{key:"getContainer",value:function(){return g.j(this.refs.vizcontainer)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",null,this.state.regionName),r.a.createElement("div",{ref:"vizcontainer",className:"map"}))}}]),e}(a.Component),z=(n(57),a.Component,function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(L,null),r.a.createElement("div",{id:"sales-data"}))}}]),e}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[37,2,1]]]);
//# sourceMappingURL=main.8ec08959.chunk.js.map