(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},35:function(e,t,n){},39:function(e,t,n){e.exports=n(66)},44:function(e,t,n){},46:function(e,t,n){},64:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(24),o=n.n(i),s=(n(44),n(4)),c=n(5),l=n(8),u=n(6),p=n(7),m=(n(46),n(9)),d=n(2),v=n(25),h=n.n(v);function g(e,t,n,a){var r,i=["blue","yellow","red"],o=e.append("svg").attr("width",parseInt(t)+70).attr("height",parseInt(n)+20);r=document.getElementsByClassName("tooltip")[0]?d.i(".tooltip"):d.i("body").append("div").attr("class",a("tooltip")).style("opacity",0);var s=d.g().rangeRound([70,t]),c=d.h().rangeRound([n,20]);o.append("g").attr("transform","translate(20,"+(n/2+10)+")").append("text").attr("class",a("percentage-label")).attr("transform","rotate(-90)").text("PERCENTAGE VOTES").attr("text-anchor","middle"),o.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")"),o.append("g").attr("class","y axis").attr("transform","translate(70, 0)");var l=o.append("g").attr("class",a("bar-container")),u=o.append("g").attr("class",a("bartext-container"));this.draw=function(e){s.domain(e.map(function(e){return e.name})),c.domain([0,100]),o.select(".x.axis").transition().duration(300).call(d.a(s)),o.select(".y.axis").transition().duration(300).call(d.b(c).ticks(6).tickFormat(function(e){return e+"%"}));var t=l.selectAll(".".concat(a("bar"))).data(e);t.exit().transition().duration(300).attr("y",function(e){return c(0)}).attr("height",0).style("fill-opacity",1e-6).remove(),t.enter().append("rect").attr("class",a("bar")).attr("x",function(e){return s(e.name)+s.bandwidth()/20}).attr("width",9*s.bandwidth()/10).attr("fill",function(e,t){return i[t%i.length]}).on("mousemove",function(e){var t;d.i(this).attr("opacity",.8),r.transition().duration(200).style("opacity",.9),r.html((t=e.partyInfo.name,t.split("/")[0].toLowerCase().replace(/\b\w/g,function(e){return e.toUpperCase()})+" : "+e.percOfVotes+"%")).style("left",d.c.pageX+"px").style("top",d.c.pageY-28+"px")}).on("mouseout",function(e){d.i(this).attr("opacity",1),r.transition().duration(200).style("opacity",0)}).attr("y",function(e){return c(0)}).attr("height",0),l.selectAll(".".concat(a("bar"))).data(e).transition().duration(300).attr("y",function(e){return c(Number(e.percOfVotes))}).attr("height",function(e){return n-c(Number(e.percOfVotes))});var p=u.selectAll(".".concat(a("bartext"))).data(e);p.exit().transition().duration(300).attr("y",function(e){return c(0)-5}).style("fill-opacity",1e-6).remove(),p.enter().append("text").attr("class",a("bartext")).attr("x",function(e){return s(e.name)+s.bandwidth()/2}).attr("text-anchor","middle").attr("font-size","12px").attr("y",function(e){return c(0)-5}),u.selectAll(".".concat(a("bartext"))).data(e).text(function(e){return e.percOfVotes+"%"}).transition().duration(300).attr("y",function(e){return c(Number(e.percOfVotes))-5})},this.destroy=function(){o.remove()}}var y="region-change",f="barchart-preview",b=n(13),N=n(73),E=n(37),w=n(74),C=n(14),O=n.n(C);function j(){var e=Object(b.a)(['\n      {\n        allVotingDistrictBallots(location_Id:"','", \n        event_Description_Icontains:"2014", \n        location_Ward_Municipality_Name_Icontains:"','") {\n          edges{\n            node{\n              location {\n                vdNumber\n              }\n              topResult(last:',") {\n                edges{\n                  node{\n                    party{\n                      name\n                    }\n                    percOfVotes\n                  }\n                }  \n              }\n            }\n          }\n        }\n      }\n      "]);return j=function(){return e},e}function T(){var e=Object(b.a)(['\n      {\n        allMunicipalBallots(location_Province_Name:"','", \n          event_Description:"2014 National Election",\n          location_Name: "','"\n        ) {\n          edges{\n            node {\n              topResult(last:',"){\n                edges{\n                  node{\n                    party {               \n                      name\n                      abbreviation\n                    }\n                    validVotes\n                    percOfVotes\n                  }\n                }\n                \n              }\n              location {\n                code\n                name\n                longName\n              }\n            }\n          }\n        }\n      }\n      "]);return T=function(){return e},e}function k(){var e=Object(b.a)(['\n      {\n        allProvincialBallots(location_Name_Icontains:"','"){\n          edges{\n            node{\n              topResult(last:',") {\n                edges{\n                  node{\n                    validVotes\n                    percOfVotes\n                    party {\n                      id\n                      name\n                      abbreviation\n                    }\n                  }\n                }\n              }\n              location {\n                id\n                name\n              }\n            }\n          }\n        }\n      }\n      "]);return k=function(){return e},e}function x(){var e=Object(b.a)(['\n      {\n        allProvincialBallots(location_Name_Icontains:"Country"){\n          edges{\n            node{\n              topResult(last:',") {\n                edges{\n                  node{\n                    validVotes\n                    percOfVotes\n                    party {\n                      id\n                      name\n                      abbreviation\n                    }\n                  }\n                }\n                \n              }\n              location {\n                id\n                name\n              }\n            }\n          }\n        }\n      }\n      "]);return x=function(){return e},e}var P=new N.a({link:new E.a({uri:"https://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new w.a});var I,R=3e4;function S(e){return h.a[e]||e}var _=0,V=function(e){function t(e){var n;Object(s.a)(this,t),n=Object(l.a)(this,Object(u.a)(t).call(this,e));var a=Object(m.a)(Object(m.a)(n));return n.state={numParties:5,regionType:"national",provinceName:"",muniName:"",muniCode:"",vdNumber:"",width:600,height:220},e.numParties&&(n.state.numParties=e.numParties),e.regionType&&(n.state.regionType=e.regionType),e.provinceName&&(n.state.provinceName=e.provinceName),e.muniName&&(n.state.muniName=e.muniName),e.muniCode&&(n.state.muniCode=e.muniCode),e.vdNumber&&(n.state.vdNumber=e.vdNumber),e.width&&(n.state.width=e.width),e.height&&(n.state.height=e.height),_=setInterval(function(){a.draw(a.getContainer(),a.state)},R),n.handleRegionChange=n.handleRegionChange.bind(Object(m.a)(Object(m.a)(n))),n.handlePreviewEvent=n.handlePreviewEvent.bind(Object(m.a)(Object(m.a)(n))),n.redrawChart=n.redrawChart.bind(Object(m.a)(Object(m.a)(n))),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.state),document.addEventListener(y,this.handleRegionChange),document.addEventListener(f,this.handlePreviewEvent),window.addEventListener("resize",this.redrawChart,200)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.state)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(y,this.handleRegionChange),document.removeEventListener(f,this.handlePreviewEvent),window.removeEventListener("resize",this.redrawChart),clearInterval(_)}},{key:"redrawChart",value:function(){var e=Math.min(810,document.body.clientWidth-350),t=e/2.5;I&&I.destroy(),I=new g(this.getContainer(),e,t,S),this.setState({width:e,height:t})}},{key:"handleRegionChange",value:function(e){var t=e.detail;console.log("handleRegionChange",t),this.setState(t)}},{key:"handlePreviewEvent",value:function(e){var t=e.detail;console.log("handlePreviewEvent",t),I&&I.destroy(),I=new g(this.getContainer(),this.state.width,this.state.height,S),this.setState(t)}},{key:"getContainer",value:function(){return d.i(this.refs.vizcontainer)}},{key:"getRegionName",value:function(){return"national"==this.state.regionType?"SA":"province"==this.state.regionType?this.state.provinceName:"municipality"==this.state.regionType?this.state.muniName:"municipality-vd"==this.state.regionType?this.state.muniName+"-"+this.state.vdNumber:void 0}},{key:"render",value:function(){return r.a.createElement("div",{className:"barchart"},r.a.createElement("div",{className:S("chart-title")},"RACE FOR VOTES (",this.getRegionName(),"): "),r.a.createElement("div",{ref:"vizcontainer",className:S("chart-body"),style:{width:this.state.width,height:this.state.height}}))}},{key:"draw",value:function(e,t){var n,a=this;(n={numParties:t.numParties,regionType:t.regionType,provinceName:t.provinceName,muniName:t.muniName,muniCode:t.muniCode,vdNumber:t.vdNumber},"national"==n.regionType?P.query({query:O()(x(),n.numParties)}):"province"==n.regionType?P.query({query:O()(k(),n.provinceName,n.numParties)}):"municipality"==n.regionType?P.query({query:O()(T(),n.provinceName,n.muniName,n.numParties)}):"municipality-vd"==n.regionType?P.query({query:O()(j(),n.vdNumber,n.muniCode,n.numParties)}):void 0).then(function(n){a.drawGraph(e,t,n)}).catch(function(e){return console.error(e)})}},{key:"drawGraph",value:function(e,t,n){var a,r,i=t.regionType;if(r="national"==i||"province"==i?n.data.allProvincialBallots.edges[0]:"municipality"==i?n.data.allMunicipalBallots.edges[0]:n.data.allVotingDistrictBallots.edges[0]){var o=r.node;a=(o.partyResults||o.topResult).edges.map(function(e){var t=e.node;return{name:t.party.abbreviation,validVotes:t.validVotes,percOfVotes:t.percOfVotes,partyInfo:t.party}}).reverse();var s=parseInt(t.width),c=parseInt(t.height);I||(I=new g(e,s,c,S)),I.draw(a)}else console.error("party data is empty!!")}}]),t}(a.Component),A={DOMAIN:"https://sabc-eds.github.io/elections-dataviz"},L=n(20),M=n.n(L),D=n(32),B=n.n(D);function z(e){return M.a[e]||B.a[e]||e}var U=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={elementId:"root",regionType:"province",regionName:"Western Cape",numParties:5},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"onRegionTypeChange",value:function(e){var t={regionType:e.target.value};"national"==t.regionType?t.regionName="SA":t.regionName="",this.setState(t)}},{key:"onPreview",value:function(e){var t=new CustomEvent(f,{detail:this.state});document.dispatchEvent(t)}},{key:"render",value:function(){var e=this,t=A.DOMAIN,n=this.state,a=n.elementId,i=n.regionType,o=n.regionName,s=n.numParties;return r.a.createElement("div",null,r.a.createElement("h3",null," Barchart Embed Script Generation "),r.a.createElement("div",{className:z("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:z("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:z("form-group")},r.a.createElement("label",null,"Region Type "),r.a.createElement("select",{className:z("form-control"),value:i,onChange:this.onRegionTypeChange.bind(this)},r.a.createElement("option",{value:"national"},"national"),r.a.createElement("option",{value:"province"},"province"))),r.a.createElement("div",{className:z("form-group")},r.a.createElement("label",null,"Region Name"),r.a.createElement("input",{type:"text",className:z("form-control"),placeholder:"Western Cape",value:o,onChange:function(t){return e.setState({regionName:t.target.value})},disabled:"national"==i})),r.a.createElement("div",{className:z("form-group")},r.a.createElement("label",null,"Number Of Parties"),r.a.createElement("input",{type:"number",className:z("form-control"),placeholder:"5",value:s,onChange:function(t){return e.setState({numParties:t.target.value})}})),r.a.createElement("div",{className:z("form-group")},r.a.createElement("button",{type:"button",onClick:this.onPreview.bind(this),className:z("btn")+" "+z("btn-primary")},"Preview")),r.a.createElement("div",{className:z("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:z("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showBarChart(document.getElementById("').concat(a,'","').concat(i,'","').concat(o,'",').concat(s,"));<\/script>")))))}}]),t}(a.Component),q=n(36),G=n(21),W=n.n(G),F=n(33),J=n.n(F),Y=n(34),H=n.n(Y);function K(e){return J.a[e]||e}var X=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={regionType:"national",provinceName:"",muniName:"",muniCode:"",vdNumber:""},e.regionType&&(n.state.regionType=e.regionType),e.regionName&&(n.state.regionName=e.regionName),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"drawGraph",value:function(e,t){var n=this,a="province_lo-res.geojson";var r,i=A.DOMAIN+"/mapdata/"+function(){switch(n.state.regionType){case"national":return a;case"province":return{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[n.state.provinceName];case"municipality":return n.state.muniCode+".topojson";default:return null}}();n.getLoadingSpinner().style("display","block").transition().duration(200).style("opacity",1),r=document.getElementsByClassName("tooltip")[0]?d.i(".tooltip"):d.i("body").append("div").attr("class",K("tooltip")).style("opacity",0),console.log("process.env",Object({NODE_ENV:"production",PUBLIC_URL:"."})),console.log("fullRouteGeoJsonFile",i);e.selectAll("svg").remove();var o=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#ffffff").attr("viewBox","0 0 900 800").classed("svg-content",!0);o.append("foreignObject").attr("x",800).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var e,t=n.state.regionType,a={regionType:n.state.regionType,provinceName:n.state.provinceName,muniName:n.state.muniName,muniImuniCodeD:n.state.muniCode,vdNumber:n.state.vdNumber};"province"===t?a.regionType="national":"municipality"===t&&(a.regionType="province"),e=new CustomEvent(y,{detail:a}),document.dispatchEvent(e),n.setState(a)});var s=d.f(i);Promise.all([s]).then(function(e){var t,a=e[0];-1!==i.indexOf(".topojson")&&(a=q.a(a,a.objects[n.state.muniCode])),t=a.features;var s=d.d().fitSize([900,800],a),c=d.e().projection(s);if(o.selectAll(".".concat(K("region"))).data(t).enter().append("path").attr("class",K("region")).attr("stroke","#eeeeee").attr("fill","#9c9c9c").attr("id",function(e,t){return"region-".concat(t)}).attr("d",c),"municipality"!==n.state.regionType&&o.selectAll(".place-label").data(t).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(e){var t,n;return"Polygon"===e.geometry.type?(t=W()(e.geometry.coordinates),(n=s(t))[1]-=12,"translate("+n+")"):(t=W()(e.geometry.coordinates[0]),(n=s(t))[1]-=5,"translate("+n+")")}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return"national"===n.state.regionType?e.properties.SPROVINCE:"province"===n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]}),"municipality"!==n.state.regionType){var l,u=document.getElementsByClassName("place-label"),p={},m={};for(l=0;l<t.length;l++)p[l]=u[l].getBoundingClientRect();for(l=0;l<t.length;l++){for(var v=0;v<l;v++){var h=p[l],g=p[v];!(h.right<g.left||h.left>g.right||h.bottom<g.top||h.top>g.bottom)&&(m[l]=m[l]?m[l]+1:1)}m[l]>2?u[l].setAttribute("opacity",0):m[l]>0&&(u[l].innerHTML=u[l].innerHTML.slice(0,3)+"...")}}o.selectAll(".eventLayer").data(t).enter().append("path").attr("d",c).attr("class","eventLayer").attr("id",function(e,t){return"eventLayer-".concat(t)}).attr("fill","transparent").on("mouseover",function(e,t){d.i("#region-".concat(t)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(e){"municipality"!==n.state.regionType&&(r.transition().duration(200).style("opacity",1),r.html("national"===n.state.regionType?e.properties.SPROVINCE:"province"===n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",d.c.pageX+"px").style("top",d.c.pageY-28+"px"))}).on("mouseout",function(e,t){d.i("#region-".concat(t)).attr("stroke-width",1).style("fill-opacity",1),"municipality"!==n.state.regionType&&r.transition().duration(200).style("opacity",0)}).on("click",function(e,t){console.log("click event",t,e.properties),r.transition().duration(200).style("opacity",0);var a,i=n.state.regionType;if("national"===i)o={regionType:"province",provinceName:e.properties.SPROVINCE},s=new CustomEvent(y,{detail:o}),document.dispatchEvent(s),n.setState(o);else if("province"===i){o={regionType:"municipality",provinceName:n.state.provinceName,muniName:e.properties.smunicipal,muniCode:(a=e.properties,a.code||a.smunicipal.split("-")[0].replace(/\s/g,""))},s=new CustomEvent(y,{detail:o}),document.dispatchEvent(s),n.setState(o)}else{var o={regionType:"municipality-vd",provinceName:n.state.provinceName,muniName:n.state.muniName,muniCode:n.state.muniCode,vdNumber:function(e){return e.PKLVDNUMBE}(e.properties)},s=new CustomEvent(y,{detail:o});document.dispatchEvent(s)}}),n.getLoadingSpinner().style("display","none")});window.addEventListener("resize",function(){},200)}},{key:"draw",value:function(e,t){this.drawGraph(e,t)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.props)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.props)}},{key:"getContainer",value:function(){return d.i(this.refs.vizcontainer)}},{key:"getLoadingSpinner",value:function(){return d.i(this.refs.loading)}},{key:"render",value:function(){return r.a.createElement("div",{className:"map-container"},r.a.createElement("div",null,this.state.regionName),r.a.createElement("div",{className:"loading-spinner",ref:"loading"},r.a.createElement(H.a,{type:"spin",color:"#777",height:100,width:100})),r.a.createElement("div",{ref:"vizcontainer",className:"map"}))}}]),t}(a.Component),Q=n(35),Z=n.n(Q);function $(e){return M.a[e]||Z.a[e]||e}var ee=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={elementId:"root",regionType:"province",locationName:"Western Cape",numParties:5},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=A.DOMAIN,n=this.state.elementId;return r.a.createElement("div",null,r.a.createElement("h3",null," Map Embed Script Generation "),r.a.createElement("div",{className:$("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:$("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:$("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:$("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showMap(document.getElementById("').concat(n,'"));<\/script>')))))}}]),t}(a.Component),te=(n(64),a.Component,function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"leftContainer"},r.a.createElement(V,{width:"600",height:"220",regionName:"SA",regionType:"national",numParties:3}),r.a.createElement(X,null)),r.a.createElement("div",{className:"rightContainer"},r.a.createElement("div",{className:"barchartEmbed"},r.a.createElement(U,null)),r.a.createElement("div",{className:"mapEmbed"},r.a.createElement(ee,null))),r.a.createElement("div",{id:"sales-data"}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[39,2,1]]]);
//# sourceMappingURL=main.85c2cc5e.chunk.js.map