(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,a){},32:function(e,t,a){},33:function(e,t,a){},35:function(e,t,a){},39:function(e,t,a){e.exports=a(67)},44:function(e,t,a){},46:function(e,t,a){},64:function(e,t,a){},67:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(24),i=a.n(o),s=(a(44),a(4)),c=a(5),l=a(8),p=a(6),u=a(7),d=(a(46),a(11)),m=a(2),g=a(25),h=a.n(g),v="region-change",f=(a(18),a(73)),y=a(37),b=a(74);a(19);new f.a({link:new y.a({uri:"http://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new b.a});var E,N=3e4,w={data:{allProvincialBallots:{edges:[{node:{partyResults:{edges:[{node:{validVotes:15311,percOfVotes:84.44,party:{id:"52",name:"DEMOCRATIC ALLIANCE/DEMOKRATIESE ALLIANSIE",abbreviation:"DA"}}},{node:{validVotes:1508,percOfVotes:8.32,party:{id:"7",name:"AFRICAN NATIONAL CONGRESS",abbreviation:"ANC"}}},{node:{validVotes:328,percOfVotes:1.81,party:{id:"938",name:"AGANG SOUTH AFRICA",abbreviation:"AGANG SA"}}},{node:{validVotes:255,percOfVotes:1.41,party:{id:"945",name:"ECONOMIC FREEDOM FIGHTERS",abbreviation:"EFF"}}},{node:{validVotes:198,percOfVotes:1.09,party:{id:"4",name:"VRYHEIDSFRONT PLUS",abbreviation:"VF Plus"}}}]},location:{id:"UHJvdmluY2VUeXBlOjk5",name:"Out of Country"}}}]}}};function O(e){return h.a[e]||e}function C(e,t,a){var n,r=["blue","yellow","red"],o=e.append("svg").attr("width",t+70).attr("height",a+20);n=document.getElementsByClassName("tooltip")[0]?m.i(".tooltip"):m.i("body").append("div").attr("class",O("tooltip")).style("opacity",0);var i=m.g().rangeRound([70,t]),s=m.h().rangeRound([a,20]);o.append("g").attr("transform","translate(20,"+(a/2+10)+")").append("text").attr("class",O("percentage-label")).attr("transform","rotate(-90)").text("PERCENTAGE VOTES").attr("text-anchor","middle"),o.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")"),o.append("g").attr("class","y axis").attr("transform","translate(70, 0)");var c=o.append("g").attr("class",O("bar-container")),l=o.append("g").attr("class",O("bartext-container"));this.draw=function(e){i.domain(e.map(function(e){return e.name})),s.domain([0,100]),o.select(".x.axis").transition().duration(300).call(m.a(i)),o.select(".y.axis").transition().duration(300).call(m.b(s).ticks(6).tickFormat(function(e){return e+"%"}));var t=c.selectAll(".".concat(O("bar"))).data(e);t.exit().transition().duration(300).attr("y",function(e){return s(0)}).attr("height",0).style("fill-opacity",1e-6).remove(),t.enter().append("rect").attr("class",O("bar")).attr("x",function(e){return i(e.name)+i.bandwidth()/20}).attr("width",9*i.bandwidth()/10).attr("fill",function(e,t){return r[t%r.length]}).on("mousemove",function(e){var t;m.i(this).attr("opacity",.8),n.transition().duration(200).style("opacity",.9),n.html((t=e.partyInfo.name,t.split("/")[0].toLowerCase().replace(/\b\w/g,function(e){return e.toUpperCase()})+" : "+e.percOfVotes+"%")).style("left",m.c.pageX+"px").style("top",m.c.pageY-28+"px")}).on("mouseout",function(e){m.i(this).attr("opacity",1),n.transition().duration(200).style("opacity",0)}).attr("y",function(e){return s(0)}).attr("height",0),c.selectAll(".".concat(O("bar"))).data(e).transition().duration(300).attr("y",function(e){return s(Number(e.percOfVotes))}).attr("height",function(e){return a-s(Number(e.percOfVotes))});var p=l.selectAll(".".concat(O("bartext"))).data(e);p.exit().transition().duration(300).attr("y",function(e){return s(0)-5}).style("fill-opacity",1e-6).remove(),p.enter().append("text").attr("class",O("bartext")).attr("x",function(e){return i(e.name)+i.bandwidth()/2}).attr("text-anchor","middle").attr("font-size","12px").attr("y",function(e){return s(0)-5}),l.selectAll(".".concat(O("bartext"))).data(e).text(function(e){return e.percOfVotes+"%"}).transition().duration(300).attr("y",function(e){return s(Number(e.percOfVotes))-5})},this.destroy=function(){o.remove()}}var j=function(e){function t(e){var a;Object(s.a)(this,t),a=Object(l.a)(this,Object(p.a)(t).call(this,e));var n=Object(d.a)(Object(d.a)(a));return a.state={numParties:5,regionName:"Western Cape",width:600,height:220},e.numParties&&(a.state.numParties=e.numParties),e.regionName&&(a.state.regionName=e.regionName),e.width&&(a.state.width=e.width),e.height&&(a.state.height=e.height),setInterval(function(){n.draw(n.getContainer(),n.state)},N),a.handleRegionChange=a.handleRegionChange.bind(Object(d.a)(Object(d.a)(a))),a.redrawChart=a.redrawChart.bind(Object(d.a)(Object(d.a)(a))),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.state),document.addEventListener(v,this.handleRegionChange),window.addEventListener("resize",this.redrawChart,200)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.state)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(v,this.handleRegionChange),window.removeEventListener("resize",this.redrawChart)}},{key:"redrawChart",value:function(){var e=document.body.clientWidth,t=document.body.clientHeight/3;E&&E.destroy(),E=new C(this.getContainer(),e,t),this.setState({width:e,height:t})}},{key:"handleRegionChange",value:function(e){this.setState({regionName:"Eastern Cape"})}},{key:"getContainer",value:function(){return m.i(this.refs.vizcontainer)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:O("chart-title")},"RACE FOR VOTES: "),r.a.createElement("div",{ref:"vizcontainer",className:O("chart-body")}))}},{key:"draw",value:function(e,t){var a=this;a.drawGraph(e,t,w)}},{key:"drawGraph",value:function(e,t,a){var n;n=a.data.allProvincialBallots.edges[0].node.partyResults.edges.map(function(e){var t=e.node;return{name:t.party.abbreviation,validVotes:t.validVotes,percOfVotes:t.percOfVotes,partyInfo:t.party}});var r=parseInt(t.width),o=parseInt(t.height);E||(E=new C(e,r,o)),E.draw(n)}}]),t}(n.Component),k={DOMAIN:"https://sabc-eds.github.io/elections-dataviz"},x=a(17),A=a.n(x),I=a(32),T=a.n(I);function S(e){return A.a[e]||T.a[e]||e}var R=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={elementId:"root",eventType:"National",regionName:"Western Cape",numParties:5},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=k.DOMAIN,a=this.state,n=a.elementId,o=a.eventType,i=a.regionName,s=a.numParties;return r.a.createElement("div",null,r.a.createElement("h3",null," Barchart Embed Script Generation "),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:S("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Event Type "),r.a.createElement("input",{type:"text",className:S("form-control"),placeholder:"National",onChange:function(t){return e.setState({eventType:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Location Name"),r.a.createElement("input",{type:"text",className:S("form-control"),placeholder:"Western Cape",onChange:function(t){return e.setState({regionName:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Number Of Parties"),r.a.createElement("input",{type:"number",className:S("form-control"),placeholder:"5",onChange:function(t){return e.setState({numParties:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:S("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showBarChart(document.getElementById("').concat(n,'","').concat(o,'","').concat(i,'",').concat(s,"));<\/script>")))))}}]),t}(n.Component),V=a(36),L=a(20),P=a.n(L),D=a(33),M=a.n(D),G=a(34),B=a.n(G);function F(e){return M.a[e]||e}var U=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={regionType:"national",regionName:"SA",parentProvinceName:""},e.regionType&&(a.state.regionType=e.regionType),e.regionName&&(a.state.regionName=e.regionName),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"drawGraph",value:function(e,t){var a=this,n="province_lo-res.geojson";var r,o=k.DOMAIN+"/mapdata/"+function(){switch(a.state.regionType){case"national":return n;case"province":return{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[a.state.regionName];case"municipality":return a.state.regionName+".topojson";default:return null}}();a.getLoadingSpinner().style("display","block").transition().duration(200).style("opacity",1),r=document.getElementsByClassName("tooltip")[0]?m.i(".tooltip"):m.i("body").append("div").attr("class",F("tooltip")).style("opacity",0),console.log("process.env",Object({NODE_ENV:"production",PUBLIC_URL:"."})),console.log("fullRouteGeoJsonFile",o);var i=1400;e.selectAll("svg").remove();var s=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#ffffff").attr("viewBox","0 0 1400 700").classed("svg-content",!0);s.append("foreignObject").attr("x",1300).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var e=a.state.regionType;if("province"===e)a.setState({regionType:"national",regionName:"SA"});else if("municipality"===e){a.setState({regionType:"province",regionName:(a.regionName,a.state.parentProvinceName)})}});var c=m.f(o);Promise.all([c]).then(function(e){console.log("json load Finished");var t,n=e[0];-1!==o.indexOf(".topojson")&&(n=V.a(n,n.objects[a.state.regionName])),t=n.features,console.log("getJsonDataFeatures",t);var c=m.d().fitSize([i,700],n),l=m.e().projection(c);if(s.selectAll(".".concat(F("region"))).data(t).enter().append("path").attr("class",F("region")).attr("stroke","#eeeeee").attr("fill","#9c9c9c").attr("id",function(e,t){return"region-".concat(t)}).attr("d",l),"municipality"!==a.state.regionType&&s.selectAll(".place-label").data(t).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(e){var t,a;return"Polygon"===e.geometry.type?(t=P()(e.geometry.coordinates),(a=c(t))[1]-=12,"translate("+a+")"):(t=P()(e.geometry.coordinates[0]),(a=c(t))[1]-=5,"translate("+a+")")}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return"national"===a.state.regionType?e.properties.SPROVINCE:"province"===a.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]}),"municipality"!==a.state.regionType){var p,u=document.getElementsByClassName("place-label"),d={},g={};for(p=0;p<t.length;p++)d[p]=u[p].getBoundingClientRect();for(p=0;p<t.length;p++){for(var h=0;h<p;h++){var f=d[p],y=d[h];!(f.right<y.left||f.left>y.right||f.bottom<y.top||f.top>y.bottom)&&(g[p]=g[p]?g[p]+1:1)}g[p]>2?u[p].setAttribute("opacity",0):g[p]>0&&(u[p].innerHTML=u[p].innerHTML.slice(0,3)+"...")}}s.selectAll(".eventLayer").data(t).enter().append("path").attr("d",l).attr("class","eventLayer").attr("id",function(e,t){return"eventLayer-".concat(t)}).attr("fill","transparent").on("mouseover",function(e,t){m.i("#region-".concat(t)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(e){"municipality"!==a.state.regionType&&(r.transition().duration(200).style("opacity",1),r.html("national"===a.state.regionType?e.properties.SPROVINCE:"province"===a.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",m.c.pageX+"px").style("top",m.c.pageY-28+"px"))}).on("mouseout",function(e,t){m.i("#region-".concat(t)).attr("stroke-width",1).style("fill-opacity",1),"municipality"!==a.state.regionType&&r.transition().duration(200).style("opacity",0)}).on("click",function(e,t){console.log("click event",t,e.properties),r.transition().duration(200).style("opacity",0);var n,o,i,s=a.state.regionType;if("national"===s)n={regionType:"province",regionName:e.properties.SPROVINCE},o=new CustomEvent(v,n),document.dispatchEvent(o),a.setState(n);else if("province"===s){n={regionType:"municipality",regionName:(i=e.properties,i.smunicipal.split("-")[0].replace(/\s/g,"")),parentProvinceName:a.state.regionName},o=new CustomEvent(v,n),document.dispatchEvent(o),a.setState(n)}}),a.getLoadingSpinner().style("display","none")});window.addEventListener("resize",function(){},200)}},{key:"draw",value:function(e,t){this.drawGraph(e,t)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.props)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.props)}},{key:"getContainer",value:function(){return m.i(this.refs.vizcontainer)}},{key:"getLoadingSpinner",value:function(){return m.i(this.refs.loading)}},{key:"render",value:function(){return r.a.createElement("div",{className:"map-container"},r.a.createElement("div",null,this.state.regionName),r.a.createElement("div",{className:"loading-spinner",ref:"loading"},r.a.createElement(B.a,{type:"spin",color:"#777",height:100,width:100})),r.a.createElement("div",{ref:"vizcontainer",className:"map"}))}}]),t}(n.Component),z=a(35),_=a.n(z);function W(e){return A.a[e]||_.a[e]||e}var H=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={elementId:"root",eventType:"National",locationName:"Western Cape",numParties:5},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=k.DOMAIN,a=this.state.elementId;return r.a.createElement("div",null,r.a.createElement("h3",null," Map Embed Script Generation "),r.a.createElement("div",{className:W("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:W("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:W("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:W("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showMap(document.getElementById("').concat(a,'"));<\/script>')))))}}]),t}(n.Component),J=(a(64),n.Component,function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(j,{width:"600",height:"220",regionName:"Western Cape",numParties:3}),r.a.createElement("div",{className:"barchartEmbed"},r.a.createElement(R,null)),r.a.createElement(U,null),r.a.createElement("div",{className:"mapEmbed"},r.a.createElement(H,null)),r.a.createElement("div",{id:"sales-data"}))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[39,2,1]]]);
//# sourceMappingURL=main.cd413195.chunk.js.map