(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},35:function(e,t,n){},39:function(e,t,n){e.exports=n(66)},44:function(e,t,n){},46:function(e,t,n){},64:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),i=n.n(o),l=(n(44),n(4)),s=n(5),c=n(8),p=n(6),u=n(7),d=(n(46),n(9)),m=n(2),g=n(25),h=n.n(g);function v(e,t,n,a){var r,o=["blue","yellow","red"],i=e.append("svg").attr("width",parseInt(t)+70).attr("height",parseInt(n)+20);r=document.getElementsByClassName("tooltip")[0]?m.i(".tooltip"):m.i("body").append("div").attr("class",a("tooltip")).style("opacity",0);var l=m.g().rangeRound([70,t]),s=m.h().rangeRound([n,20]);i.append("g").attr("transform","translate(20,"+(n/2+10)+")").append("text").attr("class",a("percentage-label")).attr("transform","rotate(-90)").text("PERCENTAGE VOTES").attr("text-anchor","middle"),i.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")"),i.append("g").attr("class","y axis").attr("transform","translate(70, 0)");var c=i.append("g").attr("class",a("bar-container")),p=i.append("g").attr("class",a("bartext-container"));this.draw=function(e){l.domain(e.map(function(e){return e.name})),s.domain([0,100]),i.select(".x.axis").transition().duration(300).call(m.a(l)),i.select(".y.axis").transition().duration(300).call(m.b(s).ticks(6).tickFormat(function(e){return e+"%"}));var t=c.selectAll(".".concat(a("bar"))).data(e);t.exit().transition().duration(300).attr("y",function(e){return s(0)}).attr("height",0).style("fill-opacity",1e-6).remove(),t.enter().append("rect").attr("class",a("bar")).attr("x",function(e){return l(e.name)+l.bandwidth()/20}).attr("width",9*l.bandwidth()/10).attr("fill",function(e,t){return o[t%o.length]}).on("mousemove",function(e){var t;m.i(this).attr("opacity",.8),r.transition().duration(200).style("opacity",.9),r.html((t=e.partyInfo.name,t.split("/")[0].toLowerCase().replace(/\b\w/g,function(e){return e.toUpperCase()})+" : "+e.percOfVotes+"%")).style("left",m.c.pageX+"px").style("top",m.c.pageY-28+"px")}).on("mouseout",function(e){m.i(this).attr("opacity",1),r.transition().duration(200).style("opacity",0)}).attr("y",function(e){return s(0)}).attr("height",0),c.selectAll(".".concat(a("bar"))).data(e).transition().duration(300).attr("y",function(e){return s(Number(e.percOfVotes))}).attr("height",function(e){return n-s(Number(e.percOfVotes))});var u=p.selectAll(".".concat(a("bartext"))).data(e);u.exit().transition().duration(300).attr("y",function(e){return s(0)-5}).style("fill-opacity",1e-6).remove(),u.enter().append("text").attr("class",a("bartext")).attr("x",function(e){return l(e.name)+l.bandwidth()/2}).attr("text-anchor","middle").attr("font-size","12px").attr("y",function(e){return s(0)-5}),p.selectAll(".".concat(a("bartext"))).data(e).text(function(e){return e.percOfVotes+"%"}).transition().duration(300).attr("y",function(e){return s(Number(e.percOfVotes))-5})},this.destroy=function(){i.remove()}}var f="region-change",y="barchart-preview",b=(n(18),n(73)),E=n(37),N=n(74),w=(n(19),{DOMAIN:"https://sabc-eds.github.io/elections-dataviz"});new b.a({link:new E.a({uri:"http://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new N.a});var C,O=3e4;function j(e){return h.a[e]||e}var P=function(e){function t(e){var n;Object(l.a)(this,t),n=Object(c.a)(this,Object(p.a)(t).call(this,e));var a=Object(d.a)(Object(d.a)(n));return n.state={numParties:5,regionName:"SA",regionType:"national",width:600,height:220},e.numParties&&(n.state.numParties=e.numParties),e.regionName&&(n.state.regionName=e.regionName),e.width&&(n.state.width=e.width),e.height&&(n.state.height=e.height),setInterval(function(){a.draw(a.getContainer(),a.state)},O),n.handleRegionChange=n.handleRegionChange.bind(Object(d.a)(Object(d.a)(n))),n.handlePreviewEvent=n.handlePreviewEvent.bind(Object(d.a)(Object(d.a)(n))),n.redrawChart=n.redrawChart.bind(Object(d.a)(Object(d.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.state),document.addEventListener(f,this.handleRegionChange),document.addEventListener(y,this.handlePreviewEvent),window.addEventListener("resize",this.redrawChart,200)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.state)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(f,this.handleRegionChange),document.removeEventListener(y,this.handlePreviewEvent),window.removeEventListener("resize",this.redrawChart)}},{key:"redrawChart",value:function(){var e=Math.min(810,document.body.clientWidth-350),t=e/2.5;C&&C.destroy(),C=new v(this.getContainer(),e,t,j),this.setState({width:e,height:t})}},{key:"handleRegionChange",value:function(e){var t=e.detail;console.log("handleRegionChange",t),this.setState({regionName:t.regionName,regionType:t.regionType})}},{key:"handlePreviewEvent",value:function(e){var t=e.detail;console.log("handlePreviewEvent",t),C&&C.destroy(),C=new v(this.getContainer(),this.state.width,this.state.height,j),this.setState({regionName:t.regionName,regionType:t.regionType,numParties:t.numParties})}},{key:"getContainer",value:function(){return m.i(this.refs.vizcontainer)}},{key:"render",value:function(){return r.a.createElement("div",{className:"barchart"},r.a.createElement("div",{className:j("chart-title")},"RACE FOR VOTES (",this.state.regionName,"): "),r.a.createElement("div",{ref:"vizcontainer",className:j("chart-body")}))}},{key:"draw",value:function(e,t){var n=this;(function(e){var t=w.DOMAIN+"/votedata/results.json";"municipality"==e.regionType&&(t=w.DOMAIN+"/votedata/wc_munis.json");var n=m.f(t);return new Promise(function(t,a){n.then(function(n){n.data.allProvincialBallots.edges=n.data.allProvincialBallots.edges.filter(function(t){return"national"==e.regionType?-1!=t.node.location.name.indexOf("Country"):"province"==e.regionType?t.node.location.name==e.regionName:-1!=t.node.location.name.indexOf(e.regionName)}),n.data.allProvincialBallots.edges.length&&(n.data.allProvincialBallots.edges[0].node.partyResults.edges=n.data.allProvincialBallots.edges[0].node.partyResults.edges.slice(0,e.numParties)),t(n)}).catch(function(e){console.error("error",e),a(e)})})})({numParties:t.numParties||5,regionName:t.regionName||"Western Cape",regionType:t.regionType||"province"}).then(function(a){n.drawGraph(e,t,a)}).catch(function(e){return console.error(e)})}},{key:"drawGraph",value:function(e,t,n){var a;a=n.data.allProvincialBallots.edges[0].node.partyResults.edges.map(function(e){var t=e.node;return{name:t.party.abbreviation,validVotes:t.validVotes,percOfVotes:t.percOfVotes,partyInfo:t.party}});var r=parseInt(t.width),o=parseInt(t.height);C||(C=new v(e,r,o,j)),C.draw(a)}}]),t}(a.Component),k=n(17),T=n.n(k),x=n(32),I=n.n(x);function S(e){return T.a[e]||I.a[e]||e}var A=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(p.a)(t).call(this,e))).state={elementId:"root",regionType:"province",regionName:"Western Cape",numParties:5},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"onRegionTypeChange",value:function(e){var t={regionType:e.target.value};"national"==t.regionType?t.regionName="SA":t.regionName="",this.setState(t)}},{key:"onPreview",value:function(e){var t=new CustomEvent(y,{detail:this.state});document.dispatchEvent(t)}},{key:"render",value:function(){var e=this,t=w.DOMAIN,n=this.state,a=n.elementId,o=n.regionType,i=n.regionName,l=n.numParties;return r.a.createElement("div",null,r.a.createElement("h3",null," Barchart Embed Script Generation "),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:S("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Region Type "),r.a.createElement("select",{className:S("form-control"),value:o,onChange:this.onRegionTypeChange.bind(this)},r.a.createElement("option",{value:"national"},"national"),r.a.createElement("option",{value:"province"},"province"))),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Region Name"),r.a.createElement("input",{type:"text",className:S("form-control"),placeholder:"Western Cape",value:i,onChange:function(t){return e.setState({regionName:t.target.value})},disabled:"national"==o})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Number Of Parties"),r.a.createElement("input",{type:"number",className:S("form-control"),placeholder:"5",value:l,onChange:function(t){return e.setState({numParties:t.target.value})}})),r.a.createElement("div",{className:S("form-group")},r.a.createElement("button",{type:"button",onClick:this.onPreview.bind(this),className:S("btn")+" "+S("btn-primary")},"Preview")),r.a.createElement("div",{className:S("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:S("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showBarChart(document.getElementById("').concat(a,'","').concat(o,'","').concat(i,'",').concat(l,"));<\/script>")))))}}]),t}(a.Component),R=n(36),L=n(20),M=n.n(L),B=n(33),D=n.n(B),V=n(34),z=n.n(V);function _(e){return D.a[e]||e}var W=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(p.a)(t).call(this,e))).state={regionType:"national",regionName:"SA",parentProvinceName:""},e.regionType&&(n.state.regionType=e.regionType),e.regionName&&(n.state.regionName=e.regionName),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"drawGraph",value:function(e,t){var n=this,a="province_lo-res.geojson";var r,o=w.DOMAIN+"/mapdata/"+function(){switch(n.state.regionType){case"national":return a;case"province":return{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[n.state.regionName];case"municipality":return n.state.regionName+".topojson";default:return null}}();n.getLoadingSpinner().style("display","block").transition().duration(200).style("opacity",1),r=document.getElementsByClassName("tooltip")[0]?m.i(".tooltip"):m.i("body").append("div").attr("class",_("tooltip")).style("opacity",0),console.log("process.env",Object({NODE_ENV:"production",PUBLIC_URL:"."})),console.log("fullRouteGeoJsonFile",o);e.selectAll("svg").remove();var i=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#ffffff").attr("viewBox","0 0 900 800").classed("svg-content",!0);i.append("foreignObject").attr("x",800).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var e,t,a=n.state.regionType;if("province"===a)e={regionType:"national",regionName:"SA"},t=new CustomEvent(f,{detail:e}),document.dispatchEvent(t),n.setState(e);else if("municipality"===a){e={regionType:"province",regionName:(n.regionName,n.state.parentProvinceName)},t=new CustomEvent(f,{detail:e}),document.dispatchEvent(t),n.setState(e)}});var l=m.f(o);Promise.all([l]).then(function(e){console.log("json load Finished");var t,a=e[0];-1!==o.indexOf(".topojson")&&(a=R.a(a,a.objects[n.state.regionName])),t=a.features,console.log("getJsonDataFeatures",t);var l=m.d().fitSize([900,800],a),s=m.e().projection(l);if(i.selectAll(".".concat(_("region"))).data(t).enter().append("path").attr("class",_("region")).attr("stroke","#eeeeee").attr("fill","#9c9c9c").attr("id",function(e,t){return"region-".concat(t)}).attr("d",s),"municipality"!==n.state.regionType&&i.selectAll(".place-label").data(t).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(e){var t,n;return"Polygon"===e.geometry.type?(t=M()(e.geometry.coordinates),(n=l(t))[1]-=12,"translate("+n+")"):(t=M()(e.geometry.coordinates[0]),(n=l(t))[1]-=5,"translate("+n+")")}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return"national"===n.state.regionType?e.properties.SPROVINCE:"province"===n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]}),"municipality"!==n.state.regionType){var c,p=document.getElementsByClassName("place-label"),u={},d={};for(c=0;c<t.length;c++)u[c]=p[c].getBoundingClientRect();for(c=0;c<t.length;c++){for(var g=0;g<c;g++){var h=u[c],v=u[g];!(h.right<v.left||h.left>v.right||h.bottom<v.top||h.top>v.bottom)&&(d[c]=d[c]?d[c]+1:1)}d[c]>2?p[c].setAttribute("opacity",0):d[c]>0&&(p[c].innerHTML=p[c].innerHTML.slice(0,3)+"...")}}i.selectAll(".eventLayer").data(t).enter().append("path").attr("d",s).attr("class","eventLayer").attr("id",function(e,t){return"eventLayer-".concat(t)}).attr("fill","transparent").on("mouseover",function(e,t){m.i("#region-".concat(t)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(e){"municipality"!==n.state.regionType&&(r.transition().duration(200).style("opacity",1),r.html("national"===n.state.regionType?e.properties.SPROVINCE:"province"===n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",m.c.pageX+"px").style("top",m.c.pageY-28+"px"))}).on("mouseout",function(e,t){m.i("#region-".concat(t)).attr("stroke-width",1).style("fill-opacity",1),"municipality"!==n.state.regionType&&r.transition().duration(200).style("opacity",0)}).on("click",function(e,t){console.log("click event",t,e.properties),r.transition().duration(200).style("opacity",0);var a,o,i,l=n.state.regionType;if("national"===l)a={regionType:"province",regionName:e.properties.SPROVINCE},o=new CustomEvent(f,{detail:a}),document.dispatchEvent(o),n.setState(a);else if("province"===l){a={regionType:"municipality",regionName:(i=e.properties,i.smunicipal.split("-")[0].replace(/\s/g,"")),parentProvinceName:n.state.regionName},console.log("newState.parentProvinceName",a.parentProvinceName),"Western Cape"==a.parentProvinceName&&(o=new CustomEvent(f,{detail:a}),document.dispatchEvent(o)),n.setState(a)}}),n.getLoadingSpinner().style("display","none")});window.addEventListener("resize",function(){},200)}},{key:"draw",value:function(e,t){this.drawGraph(e,t)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.props)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.props)}},{key:"getContainer",value:function(){return m.i(this.refs.vizcontainer)}},{key:"getLoadingSpinner",value:function(){return m.i(this.refs.loading)}},{key:"render",value:function(){return r.a.createElement("div",{className:"map-container"},r.a.createElement("div",null,this.state.regionName),r.a.createElement("div",{className:"loading-spinner",ref:"loading"},r.a.createElement(z.a,{type:"spin",color:"#777",height:100,width:100})),r.a.createElement("div",{ref:"vizcontainer",className:"map"}))}}]),t}(a.Component),G=n(35),U=n.n(G);function F(e){return T.a[e]||U.a[e]||e}var J=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(p.a)(t).call(this,e))).state={elementId:"root",regionType:"province",locationName:"Western Cape",numParties:5},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=w.DOMAIN,n=this.state.elementId;return r.a.createElement("div",null,r.a.createElement("h3",null," Map Embed Script Generation "),r.a.createElement("div",{className:F("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:F("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:F("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:F("embedcode")},r.a.createElement("span",null,'<script src="'.concat(t,'/embed/embed.js"><\/script><script>showMap(document.getElementById("').concat(n,'"));<\/script>')))))}}]),t}(a.Component),Y=(n(64),a.Component,function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"leftContainer"},r.a.createElement(P,{width:"600",height:"220",regionName:"SA",regionType:"national",numParties:3}),r.a.createElement(W,null)),r.a.createElement("div",{className:"rightContainer"},r.a.createElement("div",{className:"barchartEmbed"},r.a.createElement(A,null)),r.a.createElement("div",{className:"mapEmbed"},r.a.createElement(J,null))),r.a.createElement("div",{id:"sales-data"}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[39,2,1]]]);
//# sourceMappingURL=main.f92b875f.chunk.js.map