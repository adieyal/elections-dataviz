(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{23:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},37:function(e,t,n){e.exports=n(66)},42:function(e,t,n){},44:function(e,t,n){},63:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(22),i=n.n(o),c=(n(42),n(4)),l=n(5),s=n(7),u=n(6),p=n(8),m=(n(44),n(11)),d=n(2),g=n(23),h=n.n(g),v="region-change",f=n(24),y=n(72),b=n(35),E=n(73),N=n(26),w=n.n(N);function j(){var e=Object(f.a)(['\n        {\n          allProvincialBallots(\n              event_Description_Icontains:"2004", \n            event_EventType_Description_Icontains:"National",\n            location_Name:"','"\n        \n          ) {\n            edges {\n              node {\n                topResult(validVotes_Gt:1000, last:',") {\n                  edges {\n                    node {\n                      validVotes\n                      party {\n                        name\n                        abbreviation\n                      }\n                    }\n                  }\n                }\n                location {\n                  name\n                }\n              }\n            }\n          }\n        }\n        "]);return j=function(){return e},e}var C=new y.a({link:new b.a({uri:"http://elections2019.xyz/graphql",useGETForQueries:!0,headers:{"Content-Type":"application/graphql"}}),cache:new E.a});var O,k=3e3,x=[{R:0,G:114,B:47},{R:3,G:62,B:108},{R:131,G:23,B:27},{R:170,G:0,B:14},{R:76,G:114,B:114},{R:191,G:135,B:50}],I=1;function P(e){return h.a[e]||e}function T(e,t,n){var a=x,r=e.append("svg").attr("width",t+70).attr("height",n+20);function o(e){return"gradientrgb-".concat(e.R,"-").concat(e.G,"-").concat(e.B)}function i(e,t){e.append("linearGradient").attr("id",o(t)).selectAll("stop").data([[0,0],[11,92],[25,15],[82,35],[100,4]]).enter().append("stop").attr("offset",function(e){return e[0]+"%"}).attr("stop-color",function(e){return function(e){var n=(t.R*(100-e)+255*e)/100,a=(t.G*(100-e)+255*e)/100,r=(t.B*(100-e)+255*e)/100;return"rgb(".concat(n,",").concat(a,",").concat(r,")")}(e[1])}).attr("stop-opacity",1)}for(var c,l=r.append("defs"),s=0;s<a.length;s++)i(l,a[s]);c=document.getElementsByClassName("tooltip")[0]?d.j(".tooltip"):d.j("body").append("div").attr("class",P("tooltip")).style("opacity",0);var u=d.h().rangeRound([70,t]),p=d.i().rangeRound([n,20]);r.append("g").attr("transform","translate(20,"+(n/2+10)+")").append("text").attr("class",P("percentage-label")).attr("transform","rotate(-90)").text("PERCENTAGE VOTES").attr("text-anchor","middle"),r.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")"),r.append("g").attr("class","y axis").attr("transform","translate(70, 0)"),r.append("g").attr("class",P("grid")).attr("transform","translate(70, 0)");var m=r.append("g").attr("class",P("bar-container")),g=r.append("g").attr("class",P("bartext-container"));this.draw=function(e){u.domain(e.map(function(e){return e.name})),p.domain([0,d.g(e,function(e){return Number(e.value)})]),r.select(".x.axis").transition().duration(300).call(d.a(u)),r.select(".y.axis").transition().duration(300).call(d.b(p).ticks(6).tickSize(70-t)),r.select(".grid").transition().duration(300).call(d.b(p).ticks(6).tickSize(70-t).tickFormat(""));var i=m.selectAll(".".concat(P("bar"))).data(e);i.exit().transition().duration(300).attr("y",function(e){return p(0)}).attr("height",0).style("fill-opacity",1e-6).remove(),i.enter().append("rect").attr("class",P("bar")).attr("x",function(e){return u(e.name)+u.bandwidth()/20}).attr("width",9*u.bandwidth()/10).attr("fill",function(e,t){return"url(#".concat(o(a[t%a.length]),")")}).on("mousemove",function(e){d.j(this).attr("opacity",.8),c.transition().duration(200).style("opacity",.9),c.html(e.name+" : "+e.value).style("left",d.c.pageX+"px").style("top",d.c.pageY-28+"px")}).on("mouseout",function(e){d.j(this).attr("opacity",1),c.transition().duration(200).style("opacity",0)}).attr("y",function(e){return p(0)}).attr("height",0),m.selectAll(".".concat(P("bar"))).data(e).transition().duration(300).attr("y",function(e){return p(Number(e.value))}).attr("height",function(e){return n-p(Number(e.value))});var l=g.selectAll(".".concat(P("bartext"))).data(e);l.exit().transition().duration(300).attr("y",function(e){return p(0)-5}).style("fill-opacity",1e-6).remove(),l.enter().append("text").attr("class",P("bartext")).attr("x",function(e){return u(e.name)+u.bandwidth()/2}).attr("text-anchor","middle").attr("font-size","12px").attr("y",function(e){return p(0)-5}),g.selectAll(".".concat(P("bartext"))).data(e).text(function(e){return e.value}).transition().duration(300).attr("y",function(e){return p(Number(e.value))-5})},this.destroy=function(){r.remove()}}var R=function(e){function t(e){var n;Object(c.a)(this,t),n=Object(s.a)(this,Object(u.a)(t).call(this,e));var a=Object(m.a)(Object(m.a)(n));return n.state={numParties:5,regionName:"Western Cape",width:600,height:220},e.numParties&&(n.state.numParties=e.numParties),e.regionName&&(n.state.regionName=e.regionName),e.width&&(n.state.width=e.width),e.height&&(n.state.height=e.height),setInterval(function(){a.draw(a.getContainer(),a.state)},k),n.handleRegionChange=n.handleRegionChange.bind(Object(m.a)(Object(m.a)(n))),n.redrawChart=n.redrawChart.bind(Object(m.a)(Object(m.a)(n))),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.state),document.addEventListener(v,this.handleRegionChange),window.addEventListener("resize",this.redrawChart,200)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.state)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(v,this.handleRegionChange),window.removeEventListener("resize",this.redrawChart)}},{key:"redrawChart",value:function(){var e=document.body.clientWidth,t=document.body.clientHeight/3;O&&O.destroy(),O=new T(this.getContainer(),e,t),this.setState({width:e,height:t})}},{key:"handleRegionChange",value:function(e){this.setState({regionName:"Eastern Cape"})}},{key:"getContainer",value:function(){return d.j(this.refs.vizcontainer)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:P("chart-title")},"RACE FOR VOTES: "),r.a.createElement("div",{ref:"vizcontainer",className:P("chart-body")}))}},{key:"draw",value:function(e,t){var n,a=this;(n={numParties:t.numParties||5,regionName:t.regionName||"Western Cape"},C.query({query:w()(j(),n.regionName,n.numParties)})).then(function(n){a.drawGraph(e,t,n)}).catch(function(e){return console.error(e)})}},{key:"drawGraph",value:function(e,t,n){var a;a=n.data.allProvincialBallots.edges[0].node.topResult.edges.map(function(e){var t=e.node;return{name:t.party.abbreviation,value:t.validVotes+parseInt(.1*Math.random(I++)*t.validVotes)}}).reverse();var r=parseInt(t.width),o=parseInt(t.height);O||(O=new T(e,r,o)),O.draw(a)}}]),t}(a.Component),S=n(19),B=n.n(S),A=n(31),G=n.n(A);function _(e){return B.a[e]||G.a[e]||e}var L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={elementId:"root",eventType:"National",regionName:"Western Cape",numParties:5},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,n=t.elementId,a=t.eventType,o=t.regionName,i=t.numParties;return r.a.createElement("div",null,r.a.createElement("h3",null," Barchart Embed Script Generation "),r.a.createElement("div",{className:_("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:_("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:_("form-group")},r.a.createElement("label",null,"Event Type "),r.a.createElement("input",{type:"text",className:_("form-control"),placeholder:"National",onChange:function(t){return e.setState({eventType:t.target.value})}})),r.a.createElement("div",{className:_("form-group")},r.a.createElement("label",null,"Location Name"),r.a.createElement("input",{type:"text",className:_("form-control"),placeholder:"Western Cape",onChange:function(t){return e.setState({regionName:t.target.value})}})),r.a.createElement("div",{className:_("form-group")},r.a.createElement("label",null,"Number Of Parties"),r.a.createElement("input",{type:"number",className:_("form-control"),placeholder:"5",onChange:function(t){return e.setState({numParties:t.target.value})}})),r.a.createElement("div",{className:_("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:_("embedcode")},r.a.createElement("span",null,'<script src="DOMAIN/embed/embed.js"><\/script><script>showBarChart(document.getElementById(\''.concat(n,"','").concat(a,"','").concat(o,"',").concat(i,"));<\/script>")))))}}]),t}(a.Component),D=n(34),M=n(20),z=n.n(M),U=n(32),W=n.n(U);function F(e){return W.a[e]||e}var V=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={regionType:"national",regionName:"SA",parentProvinceName:""},e.regionType&&(n.state.regionType=e.regionType),e.regionName&&(n.state.regionName=e.regionName),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"drawGraph",value:function(e,t){console.log("drawGraph","new",this);var n=this,a="province_lo-res.geojson";var r,o="mapdata/"+function(){switch(n.state.regionType){case"national":return a;case"province":return e=n.state.regionName,console.log("getProvinceFileName",e),{Limpopo:"lim_lo-res.geojson",Mpumalanga:"mp_lo-res.geojson",Gauteng:"gt_lo-res.geojson","KwaZulu-Natal":"kzn_lo-res.geojson","North West":"nw_lo-res.geojson","Free State":"fs_lo-res.geojson","Eastern Cape":"ec_lo-res.geojson","Northern Cape":"nc_lo-res.geojson","Western Cape":"wc_lo-res.geojson"}[e];case"municipality":return n.state.regionName+".topojson"}var e}();r=document.getElementsByClassName("tooltip")[0]?d.j(".tooltip"):d.j("body").append("div").attr("class",F("tooltip")).style("opacity",0),console.log("process.env",Object({NODE_ENV:"production",PUBLIC_URL:"."})),-1!=JSON.stringify(Object({NODE_ENV:"production",PUBLIC_URL:"."})).indexOf("docz")&&(o="/public/"+o),console.log("fullRouteGeoJsonFile",o);var i=1400;e.selectAll("svg").remove();var c=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").style("background-color","#c9e8fd").attr("viewBox","0 0 1400 700").classed("svg-content",!0),l=(c.append("foreignObject").attr("x",1300).attr("y",10).attr("width",100).attr("height",30).attr("class","map-controls").append("xhtml:div").append("button").attr("class","go-back").html("go back").on("click",function(){var e=n.state.regionType;if("province"==e)n.setState({regionType:"national",regionName:"SA"});else if("municipality"==e){n.setState({regionType:"province",regionName:(n.regionName,n.state.parentProvinceName)})}}),d.f(o));Promise.all([l]).then(function(e){console.log("json load Finished");var t,a=e[0];-1!=o.indexOf(".topojson")&&(a=D.a(a,a.objects[n.state.regionName])),t=a.features,console.log("getJsonDataFeatures",t);var l=d.d().fitSize([i,700],a),s=d.e().projection(l);c.selectAll(".".concat(F("region"))).data(t).enter().append("path").attr("class",F("region")).attr("stroke","#FFF").attr("fill","green").attr("id",function(e,t){return"region-".concat(t)}).attr("d",s),c.selectAll(".place-label").data(t).enter().append("text").attr("class","place-label").attr("font-size","12px").attr("transform",function(e){if("Polygon"==e.geometry.type){var t=z()(e.geometry.coordinates);return console.log("center",t),(n=l(t))[1]-=12,"translate("+n+")"}var n;t=z()(e.geometry.coordinates[0]);return(n=l(t))[1]-=5,"translate("+n+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return"national"==n.state.regionType?e.properties.SPROVINCE:"province"==n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]});for(var u=document.getElementsByClassName("place-label"),p={},m={},g=0;g<t.length;g++)p[g]=u[g].getBoundingClientRect();for(g=0;g<t.length;g++){for(var h=0;h<g;h++){var f=p[g],y=p[h];!(f.right<y.left||f.left>y.right||f.bottom<y.top||f.top>y.bottom)&&(m[g]=m[g]?m[g]+1:1)}m[g]>2?u[g].setAttribute("opacity",0):m[g]>0&&(u[g].innerHTML=u[g].innerHTML.slice(0,3)+"...")}for(g=0;g<t.length;g++);console.log("regions",m),c.selectAll(".eventLayer").data(t).enter().append("path").attr("d",s).attr("class","eventLayer").attr("id",function(e,t){return"eventLayer-".concat(t)}).attr("fill","transparent").on("mouseover",function(e,t){d.j("#region-".concat(t)).attr("stroke-width",3).style("fill-opacity",.8)}).on("mousemove",function(e){r.transition().duration(200).style("opacity",1),r.html("national"==n.state.regionType?e.properties.SPROVINCE:"province"==n.state.regionType?e.properties.smunicipal.split("-")[1].split("[")[0]:e.properties.SMUNICIPAL.split("-")[1].split("[")[0]).style("left",d.c.pageX+"px").style("top",d.c.pageY-28+"px")}).on("mouseout",function(e,t){d.j("#region-".concat(t)).attr("stroke-width",1).style("fill-opacity",1),r.transition().duration(200).style("opacity",0)}).on("click",function(e,t){console.log("click event",t,e.properties);var a,r=n.state.regionType;if("national"==r){var o={regionType:"province",regionName:e.properties.SPROVINCE},i=new CustomEvent(v,o);document.dispatchEvent(i),n.setState(o)}else if("province"==r){o={regionType:"municipality",regionName:(a=e.properties,a.smunicipal.split("-")[0].replace(/\s/g,"")),parentProvinceName:n.state.regionName},i=new CustomEvent(v,o);document.dispatchEvent(i),n.setState(o)}else{o={regionType:"municipality-region",regionName:function(e){return e.SMUNICIPAL.split("-")[0].replace(/\s/g,"")}(e.properties)},i=new CustomEvent(v,o);document.dispatchEvent(i)}}),console.log("svg drawing finished")});window.addEventListener("resize",function(){},200)}},{key:"draw",value:function(e,t){this.drawGraph(e,t)}},{key:"componentDidMount",value:function(){this.draw(this.getContainer(),this.props)}},{key:"componentDidUpdate",value:function(){this.draw(this.getContainer(),this.props)}},{key:"getContainer",value:function(){return d.j(this.refs.vizcontainer)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",null,this.state.regionName),r.a.createElement("div",{ref:"vizcontainer",className:"map"}))}}]),t}(a.Component),J=n(33),q=n.n(J);function H(e){return B.a[e]||q.a[e]||e}var Y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={elementId:"root",eventType:"National",locationName:"Western Cape",numParties:5},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,t=this.state.elementId;return r.a.createElement("div",null,r.a.createElement("h3",null," Map Embed Script Generation "),r.a.createElement("div",{className:H("form-group")},r.a.createElement("label",null,"Element ID "),r.a.createElement("input",{type:"text",className:H("form-control"),placeholder:"chart-container",onChange:function(t){return e.setState({elementId:t.target.value})}})),r.a.createElement("div",{className:H("form-group")},r.a.createElement("label",null,"Embed Code"),r.a.createElement("div",{className:H("embedcode")},r.a.createElement("span",null,'<script src="DOMAIN/embed/embed.js"><\/script><script>showMap(document.getElementById(\''.concat(t,"'));<\/script>")))))}}]),t}(a.Component),X=(n(63),a.Component,function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(R,{width:"600",height:"220",regionName:"Western Cape",numParties:3}),r.a.createElement("div",{className:"barchartEmbed"},r.a.createElement(L,null)),r.a.createElement(V,null),r.a.createElement("div",{className:"mapEmbed"},r.a.createElement(Y,null)),r.a.createElement("div",{id:"sales-data"}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[37,2,1]]]);
//# sourceMappingURL=main.420d2d18.chunk.js.map